{"version":3,"file":"157-bf0e47.js","mappings":"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","sources":["webpack://TopWritePlugins.highlight/./src/scss/code.module.scss","webpack://TopWritePlugins.highlight/./src/components/code.tsx","webpack://TopWritePlugins.highlight/./.topwrite/use-config.ts","webpack://TopWritePlugins.highlight/../../../topteam/write/packages/node_modules/object-assign/index.js","webpack://TopWritePlugins.highlight/../../../topteam/write/packages/node_modules/react/cjs/react-jsx-runtime.production.min.js","webpack://TopWritePlugins.highlight/../../../topteam/write/packages/node_modules/react/jsx-runtime.js"],"sourcesContent":["// extracted by mini-css-extract-plugin\nexport default {\"container\":\"container--f4f52969\"};","import { useEffect, useState } from 'react';\r\nimport styles from '../scss/code.module.scss';\r\nimport useConfig from '@@/use-config';\r\nimport { InjectedCompProps, useAsyncEffect } from 'topwrite';\r\n\r\nfunction getLanguage(className: string[]) {\r\n    return className\r\n    .map(function(cl) {\r\n        // Markdown\r\n        if (cl.search('lang-') === 0) {\r\n            return cl.slice('lang-'.length);\r\n        }\r\n\r\n        // Asciidoc\r\n        if (cl.search('language-') === 0) {\r\n            return cl.slice('language-'.length);\r\n        }\r\n\r\n        return null;\r\n    })\r\n    .find(function(cl) {\r\n        return Boolean(cl);\r\n    });\r\n}\r\n\r\nasync function loadPrism() {\r\n    const Prism = await import('prismjs');\r\n    await import('prismjs/components/prism-sql');\r\n    return Prism;\r\n}\r\n\r\ninterface CodeProps {\r\n    children: string[];\r\n    className?: string[];\r\n}\r\n\r\nexport default function Code({ props: { children: codes, className } }: InjectedCompProps<CodeProps>) {\r\n\r\n    const config = useConfig();\r\n\r\n    const [html, setHtml] = useState(codes.join(''));\r\n\r\n    useEffect(() => {\r\n        return () => {\r\n            setHtml(codes.join(''));\r\n        };\r\n    }, [codes]);\r\n\r\n    useAsyncEffect(async () => {\r\n        const content = codes.join('');\r\n        if (content.match(/\\n/)) {\r\n            const Prism = await loadPrism();\r\n            //单行不高亮\r\n            try {\r\n\r\n                let lang = getLanguage(className || []);\r\n\r\n                if (!lang) {\r\n                    lang = config.getValue('defaultLanguage', 'clike');\r\n                }\r\n\r\n                let html: string;\r\n                if (!Prism.languages[lang]) {\r\n                    lang = 'clike';\r\n                }\r\n\r\n                html = Prism.highlight(content, Prism.languages[lang], lang);\r\n\r\n                setHtml(html);\r\n            } catch (e) {\r\n                console.error(e);\r\n            }\r\n        }\r\n\r\n    }, [codes, setHtml]);\r\n\r\n    return <code className={styles.container} dangerouslySetInnerHTML={{ __html: html }} />;\r\n}\r\n","import { useBook, BaseConfig } from 'topwrite';\r\nimport { Config } from './config';\r\n\r\ndeclare const PLUGIN_NAME: string;\r\n\r\ndeclare module 'topwrite' {\r\n    export interface HookContext {\r\n        getConfig(): BaseConfig<Config>;\r\n    }\r\n}\r\n\r\nexport default function useConfig(): BaseConfig<Config> {\r\n    const { config } = useBook();\r\n\r\n    const schema = require('../config.json');\r\n\r\n    return config.getPluginConfig(PLUGIN_NAME, schema);\r\n};\r\n","/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n","/** @license React v17.0.2\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';require(\"object-assign\");var f=require(\"react\"),g=60103;exports.Fragment=60107;if(\"function\"===typeof Symbol&&Symbol.for){var h=Symbol.for;g=h(\"react.element\");exports.Fragment=h(\"react.fragment\")}var m=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n=Object.prototype.hasOwnProperty,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,k){var b,d={},e=null,l=null;void 0!==k&&(e=\"\"+k);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(l=a.ref);for(b in a)n.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:g,type:c,key:e,ref:l,props:d,_owner:m.current}}exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n"],"names":["Code","props","children","codes","className","config","useBook","schema","getPluginConfig","useConfig","html","setHtml","useState","join","useEffect","useAsyncEffect","async","content","match","Prism","loadPrism","lang","map","cl","search","slice","length","find","Boolean","getLanguage","getValue","languages","highlight","e","console","error","dangerouslySetInnerHTML","__html","getOwnPropertySymbols","Object","hasOwnProperty","prototype","propIsEnumerable","propertyIsEnumerable","toObject","val","TypeError","module","exports","assign","test1","String","getOwnPropertyNames","test2","i","fromCharCode","n","test3","split","forEach","letter","keys","err","shouldUseNative","target","source","from","symbols","to","s","arguments","key","call","f","g","Symbol","for","h","m","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","ReactCurrentOwner","p","ref","__self","__source","q","c","a","k","b","d","l","defaultProps","$$typeof","type","_owner","current","jsx"],"sourceRoot":""}